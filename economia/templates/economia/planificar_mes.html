{% extends "economia/_base_adminlike.html" %}
{% load l10n %}
{% block title %}Planificar mes{% endblock %}

{% block extra_css %}
{{ block.super }}
<style>
  .wrap{padding:4px}

  .top-bar{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:16px;
  }
  .hint{color:#6b7280;font-size:12px}

  h2{margin:12px 0; display:flex; align-items:center; gap:10px;}
  h2 .add-link{font-size:13px; color:#2c7be5; text-decoration:none;}
  h2 .add-link:hover{text-decoration:underline;}

  table{width:auto;border-collapse:collapse;margin-right:auto}
  th,td{padding:6px 10px;border-bottom:1px solid #eee;vertical-align:top}
  th{text-align:left;background:#fafafa}
  .right{text-align:right;white-space:nowrap}
  .input-money{width:90px;text-align:right}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:24px}
  .money-hint{color:#555;font-size:12px;display:block;margin-top:2px}
  .delete-link{color:#d9534f;font-size:12px;display:block;margin-top:2px;text-decoration:none;cursor:pointer}
  .delete-link:hover{text-decoration:underline;color:#b52b27}

  /* botones principales */
  .btn-primary{
    background:#417690; /* mismo azul del admin */
    color:white;
    border:none;
    padding:6px 12px;
    border-radius:4px;
    cursor:pointer;
  }
  .btn-primary:hover{background:#1a5bbf;}

  .btn-danger{
    background:#d9534f;
    color:white !important;  /* texto blanco siempre */
    border:none;
    padding:6px 12px;
    border-radius:4px;
    text-decoration:none;
    display:inline-block;
  }
  .btn-danger:hover{
    background:#b52b27;
    color:white !important;
  }
</style>
{% endblock %}


{% block content_adminlike %}
<div class="wrap">
  <div class="top-bar">
    <div class="hint">Planificando: {{ month }}/{{ year|stringformat:"s" }}</div>
    <div>
      <button type="submit" form="plan-form" class="btn-primary">Guardar plan</button>
      <a href="{% url 'economia:resumen' %}" class="btn-danger" style="margin-left:8px">Cancelar</a>
    </div>
  </div>

  <form id="plan-form" method="post">
    {% csrf_token %}

    <div class="grid">

      <!-- GASTOS -->
      <section>
        <h2>
          Gastos
          <a href="{% url 'economia:categoria_nueva' 'gasto' %}?year={{ year }}&month={{ month }}"
             class="add-link">+ Add</a>
        </h2>
        <table>
          <thead>
            <tr><th>Categoría</th><th class="right">Esperado</th></tr>
          </thead>
          <tbody>
            {% for it in cats_gasto_plans %}
            <tr>
              <td>
                {{ it.cat.nombre }}
                <a href="#"
                   class="delete-link"
                   onclick="if(confirm('¿Eliminar la categoría {{ it.cat.nombre|escapejs }}?')){ document.getElementById('del-cat-{{ it.cat.id }}').submit(); } return false;">
                  Eliminar
                </a>
                <form id="del-cat-{{ it.cat.id }}" method="post"
                      action="{% url 'economia:categoria_eliminar' it.cat.id %}?year={{ year }}&month={{ month }}"
                      style="display:none">
                  {% csrf_token %}
                </form>
              </td>
              <td class="right">
                <input class="input-money" type="number" step="0.01" min="0"
                       name="esperado_{{ it.cat.id }}"
                       value="{{ it.esperado|default_if_none:0|unlocalize }}">
                <span class="money-hint">
                  ${{ it.esperado|default_if_none:0|floatformat:2|localize }}
                </span>
              </td>
            </tr>
            {% empty %}
            <tr><td colspan="2">No hay categorías de gasto.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </section>

      <!-- INGRESOS -->
      <section>
        <h2>
          Ingresos
          <a href="{% url 'economia:categoria_nueva' 'ingreso' %}?year={{ year }}&month={{ month }}"
             class="add-link">+ Add</a>
        </h2>
        <table>
          <thead>
            <tr><th>Categoría</th><th class="right">Esperado</th></tr>
          </thead>
          <tbody>
            {% for it in cats_ing_plans %}
            <tr>
              <td>
                {{ it.cat.nombre }}
                <a href="#"
                   class="delete-link"
                   onclick="if(confirm('¿Eliminar la categoría {{ it.cat.nombre|escapejs }}?')){ document.getElementById('del-cat-{{ it.cat.id }}').submit(); } return false;">
                  Eliminar
                </a>
                <form id="del-cat-{{ it.cat.id }}" method="post"
                      action="{% url 'economia:categoria_eliminar' it.cat.id %}?year={{ year }}&month={{ month }}"
                      style="display:none">
                  {% csrf_token %}
                </form>
              </td>
              <td class="right">
                <input class="input-money" type="number" step="0.01" min="0"
                       name="esperado_{{ it.cat.id }}"
                       value="{{ it.esperado|default_if_none:0|unlocalize }}">
                <span class="money-hint">
                  ${{ it.esperado|default_if_none:0|floatformat:2|localize }}
                </span>
              </td>
            </tr>
            {% empty %}
            <tr><td colspan="2">No hay categorías de ingreso.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </section>

    </div>
  </form>
</div>
{% endblock %}
