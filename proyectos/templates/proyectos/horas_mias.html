{% extends "_base.html" %}
{% block title %}Mis horas{% endblock %}

{% block content %}

<style>
  .horas-header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    flex-wrap:wrap;
    margin-bottom:8px;
  }
  .horas-filter{
    display:flex;
    align-items:center;
    gap:8px;
    flex-wrap:wrap;
    font-size:14px;
  }
  .horas-filter label{
    display:flex;
    align-items:center;
    gap:4px;
  }

  .tabla-horas { width:100%; border-collapse:collapse; margin-top:8px; }
  .tabla-horas th, .tabla-horas td { padding:10px 12px; border-top:1px solid #e5e7eb; }
  .tabla-horas th { text-align:left; font-weight:700; color:#334155; background:#f8fafc; }
  .tabla-horas tr:hover td { background:#fbfdff; }
  .btn-sm{ display:inline-block; padding:6px 10px; border:1px solid #d0d7de; border-radius:8px; background:#fff; cursor:pointer; }
  .btn-sm:hover{ background:#f8fafc; }
</style>

<div class="horas-header">
  <h1 style="margin:0;">{{ titulo }}</h1>

  <form method="get" class="horas-filter">
    <label>
      <span>Mes:</span>
      <select name="mes">
        {% for nro, nombre in meses %}
          <option value="{{ nro }}" {% if nro == mes %}selected{% endif %}>
            {{ nombre }}
          </option>
        {% endfor %}
      </select>
    </label>

    <label>
      <span>Año:</span>
      <input type="number"
             name="anio"
             value="{{ anio }}"
             min="2020"
             max="{{ anio_max }}"
             style="width:90px;">
    </label>

    <button type="submit" class="btn-sm">Filtrar</button>

    <span style="font-weight:600; margin-left:4px;">
      Total del mes: {{ total_mes|floatformat:2 }} h
    </span>
  </form>
</div>

<table class="tabla-horas">
  <thead>
    <tr>
      <th style="width:46%">Proyecto / Área</th>
      <th style="width:18%">Última fecha</th>
      <th style="width:18%">Total horas</th>
      <th style="width:10%">Reg.</th>
      <th style="width:8%"></th>
    </tr>
  </thead>
  <tbody>
    {% for g in agrupado %}
      <tr>
        <td>
          {% if g.pid %}
            <a href="{% url 'proyectos:detalle' g.pid %}">{{ g.grupo_nombre }}</a>
          {% else %}
            {{ g.grupo_nombre }}
          {% endif %}
        </td>
        <td>{{ g.ultima|date:"d/m/Y"|default:"—" }}</td>
        <td>{{ g.total_horas|floatformat:2 }}</td>
        <td>{{ g.n_reg }}</td>
        <td>
          {% if g.pid %}
            <a class="btn-sm" href="{% url 'proyectos:detalle' g.pid %}">Ver</a>
          {% endif %}
        </td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="5" style="color:#64748b">
          No tenés horas cargadas en ese mes.
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
